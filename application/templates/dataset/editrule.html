{% extends 'layouts/base.html' %}

{% from 'components/rule-table-header.html' import ruleTableHead %}

{% block beforeContent %}
<div class="govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url_for('base.index') }}">Home</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url_for('dataset.index') }}">Datasets</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url_for('dataset.dataset', dataset_id=dataset.dataset) }}">{{dataset.name}}</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url_for('dataset.ruletype', dataset_id=dataset.dataset, ruletype_name=ruletype_name) }}">{{ ruletype_name|capitalize }} rules</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">{{ rule.id|default('new') }}</li>
  </ol>
</div>
{% endblock beforeContent %}

{% block content %}

<span class="govuk-caption-xl">{{ dataset.name }} - {{ ruletype_name }} rules</span>
<h1 class="govuk-heading-xl">{% if rule.id %}Edit rule #{{ rule.id }}{% else %}Add new rule{% endif %}</h1>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <form action="" class="govuk-form">
      <div class="govuk-form-group">
        <label class="govuk-label" for="width-10">
          Dataset
        </label>
        <input class="govuk-input govuk-input--width-10 app-text-input__readonly" id="dataset" name="dataset" type="text" readonly="readonly" value="{{ rule['dataset'].name }}">
      </div>
      {% for field in ruletype_specification.fields %}
        {% if field.field == 'field' %}
        <div class="govuk-form-group">
          <label class="govuk-label" for="field">
            Field
          </label>
          <select class="govuk-select" id="field" name="field">
            {% for dataset_field in dataset.fields %}
            <option value="{{ dataset_field.field }}" {% if rule[field.field].field == dataset_field.field %}selected{% endif %}>{{ dataset_field.name }}</option>
            {% endfor %}
          </select>
        </div>
        {%- elif field.field not in ['dataset', 'start-date', 'end-date', 'entry-date'] -%}
        <div class="govuk-form-group">
          <label class="govuk-label" for="width-10">
            {{ field.name }}
          </label>
          <input class="govuk-input govuk-input--width-10" id="width-10" name="width-10" type="text" {% if rule[field.field] %}value="{{ rule[field.field] }}"{% endif %}>
        </div>
        {%- endif -%}
      {% endfor %}
      <p class="govuk-body">The dates determine when this rule will be used by the pipeline and when it is no longer needed.</p>
      <div class="govuk-form-group">
        <label class="govuk-label" for="entry-date">
          Entry date
        </label>
        <input class="govuk-input govuk-input--width-10" id="entry-date" name="entry-date" type="text" readonly="readonly" value="{{ rule['entry-date'] if rule['entry-date'] }}">
      </div>
      <div class="govuk-form-group">
        <label class="govuk-label" for="start-date">
          Start date
        </label>
        <input class="govuk-input govuk-input--width-10" id="start-date" name="start-date" type="text" readonly="readonly" value="{{ rule['start-date'] if rule['start-date'] }}">
      </div>
      <div class="govuk-form-group">
        <label class="govuk-label" for="end-date">
          End date
        </label>
        <input class="govuk-input govuk-input--width-10" id="end-date" name="end-date" type="text" readonly="readonly" value="{{ rule['end-date'] if rule['end-date'] }}">
      </div>
      <div class="govuk-button-group">
        <button class="govuk-button" data-module="govuk-button">
          Save
        </button>
        <button class="govuk-button govuk-button--warning" data-module="govuk-button">
          Delete
        </button>
        <a class="govuk-link" href="{{ url_for('dataset.ruletype', dataset_id=dataset.dataset, ruletype_name=ruletype_name) }}">Cancel</a>
      </div>
    </form>

  </div>
</div>
{% endblock content %}
