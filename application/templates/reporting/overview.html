{% extends 'layouts/base.html' %}
{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% block beforeContent %}
<script {% if config["ENV"] == "production" %}nonce="{{ csp_nonce() }}"{% endif %} src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<div class="govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
    <li class="govuk-breadcrumbs__list-item">
      <a class="govuk-breadcrumbs__link" href="{{ url_for('base.index') }}">Home</a>
    </li>
    <li class="govuk-breadcrumbs__list-item">
      Reporting
    </li>
  </ol>
</div>
{% endblock beforeContent %}

{% block content %}

<h1 class="govuk-heading-xl">Reporting - overview</h1>

<h2 id="summary-title">Today's Summary: </h2>
<p id="contributions" class="govuk-body">Contributions: </p>
<p id="errors" class="govuk-body">Endpoint errors: </p>
<input type="date" id="date-selector"></input>
<p class="govuk-body">Data errors: {{ summary_metrics.errors }}</p>
<p class="govuk-body">Data warnings: {{ summary_metrics.warnings }}</p>
<p class="govuk-body">New resources: WIP</p>

<h2>Endpoints added per week:</h2>
<div>
  <canvas id="endpoint_added_graph"></canvas>
</div>


<h2>Resources downloaded per week:</h2>
<div>
  <canvas id="resources_downloaded_graph"></canvas>
</div>

<h2>Endpoint errors and successes per week:</h2>
<div>
  <canvas id="endpoint_error_graph"></canvas>
</div>

<script type="module" {% if config["ENV"] == "production" %}nonce="{{ csp_nonce() }}"{% endif %}>
  import TimeseriesChart from "{{ assetPath | default('/assets') }}/javascripts/utilities/timeseries-chart.js"
  const baseOptions = {xAxisTitle: "Week", xAxisKey: "date", yAxisKey: "count"}

  const endpoint_added_timeseries = new TimeseriesChart(
    {
      ...baseOptions,
      yAxisTitle: "Endpoints added",
      datasets: [{
                label: "# of endpoints added per week",
                data: {{graphs.endpoints_added_timeseries | safe}},
                borderWidth: 1,
                pointRadius: 0
            }],
      htmlId: "endpoint_added_graph",
      type: "line",
    }
  ).init()

  const resources_downloaded_timeseries = new TimeseriesChart(
    {
      ...baseOptions,
      yAxisTitle: "Resources downloaded",
      datasets: [{
                  label: "# of resources downloaded per week",
                  data: {{graphs.endpoint_successes_timeseries | safe}},
                  borderWidth: 1,
                  pointRadius: 0
                }],
      htmlId: "resources_downloaded_graph",
      type: "line"
    }
  ).init()

  const endpoint_errors_timeseries = new TimeseriesChart(
    {
      ...baseOptions,
      yAxisTitle: "Endpoint Errors/Successes",
      datasets: [{
                  label: "# of endpoints erroring per week",
                  data: {{graphs.endpoint_errors_timeseries | safe}},
                  borderWidth: 1,
                  pointRadius: 0,
                  backgroundColor: "rgba(256,0,0,1)"
                },
                {
                  label: "# of endpoint successes per week",
                  data: {{graphs.endpoint_successes_timeseries | safe}},
                  borderWidth: 1,
                  pointRadius: 0,
                  backgroundColor: "rgba(0,150,0,1)"
                }
                ],
      htmlId: "endpoint_error_graph",
      type:"bar",
      stacked: true
    }
  ).init()
</script>

<script type="module" {% if config["ENV"] == "production" %}nonce="{{ csp_nonce() }}"{% endif %}>
    import SummaryMetrics from "{{ assetPath | default('/assets') }}/javascripts/reporting-summary.js"
    const summary_metrics = new SummaryMetrics({{summary_metrics | safe}}).init()
</script>

{% endblock content %}
